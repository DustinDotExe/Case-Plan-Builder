{% extends "layout.html" %}

{% block content %}
<div class="grid grid-cols-1 gap-6">
    <div class="w-full">
        <div class="bg-white rounded-lg shadow-sm overflow-hidden mb-6">
            <div class="border-b border-gray-200 bg-gray-50 px-4 py-5 sm:px-6">
                <h1 class="text-lg font-medium text-gray-900">Risk Assessment</h1>
            </div>
            <div class="px-4 py-5 sm:p-6">
                <p class="text-gray-600 mb-6">
                    Select the risk level for each domain to generate a customized case plan.
                </p>
                
                <form id="risk-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label for="client_name" class="block text-sm font-medium text-gray-700 mb-1">Client Name</label>
                            <input type="text" class="w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm" 
                                   id="client_name" name="client_name" 
                                   placeholder="Enter client name" required>
                        </div>
                        <div>
                            <label for="plan_title" class="block text-sm font-medium text-gray-700 mb-1">Plan Title</label>
                            <input type="text" class="w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm" 
                                   id="plan_title" name="plan_title" 
                                   placeholder="E.g., Initial Assessment, 90-Day Review" 
                                   value="Case Plan" required>
                        </div>
                    </div>
                    
                    <h4 class="text-lg font-medium text-gray-900 mb-4">Risk Level Assessment</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {% for domain in domains %}
                        <div class="bg-white border rounded-lg shadow-sm overflow-hidden h-full">
                            <div class="flex justify-between items-center bg-gray-50 px-4 py-3 border-b border-gray-200">
                                <h5 class="font-medium text-gray-900">{{ domain.name }}</h5>
                                <div class="relative inline-flex items-center">
                                    <div class="relative inline-block h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent 
                                                transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 
                                                domain-toggle-container">
                                        <input type="checkbox" 
                                               class="absolute h-0 w-0 opacity-0 domain-toggle"
                                               id="domain_toggle_{{ domain.id }}" 
                                               data-domain-id="{{ domain.id }}">
                                        <span class="pointer-events-none relative inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 
                                                    transition duration-200 ease-in-out toggle-dot"></span>
                                    </div>
                                    <span class="ml-2 text-sm font-medium text-gray-700">Include</span>
                                </div>
                            </div>
                            <div class="p-4">
                                <div class="domain-content" id="domain_content_{{ domain.id }}">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Risk Level:</label>
                                    <div class="flex flex-wrap gap-2 w-full" role="group" aria-label="Risk level selection">
                                        <div class="flex items-center">
                                            <input type="radio" name="risk_{{ domain.id }}" id="{{ domain.id }}_low" value="Low"
                                                   class="hidden peer">
                                            <label for="{{ domain.id }}_low" 
                                                   class="inline-flex items-center justify-center px-4 py-2 border rounded-md cursor-pointer
                                                         border-success-500 text-success-700 hover:bg-success-50
                                                         peer-checked:bg-success-500 peer-checked:text-white peer-checked:border-transparent">
                                                Low
                                            </label>
                                        </div>
                                        
                                        <div class="flex items-center">
                                            <input type="radio" name="risk_{{ domain.id }}" id="{{ domain.id }}_medium" value="Medium"
                                                   class="hidden peer">
                                            <label for="{{ domain.id }}_medium"
                                                   class="inline-flex items-center justify-center px-4 py-2 border rounded-md cursor-pointer
                                                         border-warning-500 text-warning-700 hover:bg-warning-50
                                                         peer-checked:bg-warning-500 peer-checked:text-white peer-checked:border-transparent">
                                                Medium
                                            </label>
                                        </div>
                                        
                                        <div class="flex items-center">
                                            <input type="radio" name="risk_{{ domain.id }}" id="{{ domain.id }}_high" value="High"
                                                   class="hidden peer">
                                            <label for="{{ domain.id }}_high"
                                                   class="inline-flex items-center justify-center px-4 py-2 border rounded-md cursor-pointer
                                                         border-danger-500 text-danger-700 hover:bg-danger-50
                                                         peer-checked:bg-danger-500 peer-checked:text-white peer-checked:border-transparent">
                                                High
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <div class="text-center mt-8">
                        <button type="submit" id="generate-plan-btn" 
                                class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm
                                       text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                            <svg class="h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            Generate Case Plan
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div id="plan-container" class="hidden">
    <div class="bg-white rounded-lg shadow-sm overflow-hidden mb-6">
        <div class="flex justify-between items-center border-b border-gray-200 bg-gray-50 px-4 py-4 sm:px-6">
            <h2 class="text-lg font-medium text-gray-900">Case Plan</h2>
            <div id="export-controls" class="flex space-x-2 no-print">
                <button id="export-btn" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    <svg class="h-4 w-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg> 
                    Export PDF
                </button>
                <button id="print-btn" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md shadow-sm text-white bg-gray-600 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                    <svg class="h-4 w-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                    </svg> 
                    Print
                </button>
                {% if current_user.is_authenticated %}
                <button id="save-plan-btn" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md shadow-sm text-white bg-success-600 hover:bg-success-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-success-500">
                    <svg class="h-4 w-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                    </svg> 
                    Save Plan
                </button>
                {% else %}
                <a href="{{ url_for('login') }}?next={{ url_for('index') }}" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    <svg class="h-4 w-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
                    </svg> 
                    Login to Save
                </a>
                {% endif %}
            </div>
        </div>
        <div class="px-4 py-5 sm:p-6">
            <div id="plan-content" class="plan-content"></div>
        </div>
        <div class="border-t border-gray-200 px-4 py-3 sm:px-6 bg-gray-50 text-center no-print">
            <p class="text-sm text-gray-500">
                <svg class="inline h-4 w-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                All content is editable. Click on any text to modify it.
            </p>
        </div>
    </div>
</div>

<style>
/* Custom toggle switch styling */
.domain-toggle-container {
    background-color: rgba(156, 163, 175, 0.5);
}

.domain-toggle:checked + .toggle-dot {
    transform: translateX(100%);
}

.domain-toggle:checked ~ .domain-toggle-container {
    background-color: #0ea5e9;
}

.toggle-dot {
    left: 0;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set up custom toggle switches
    const toggleContainers = document.querySelectorAll('.domain-toggle-container');
    toggleContainers.forEach(container => {
        const toggle = container.previousElementSibling;
        if (toggle && toggle.classList.contains('domain-toggle')) {
            toggle.addEventListener('change', function() {
                if (this.checked) {
                    container.style.backgroundColor = '#0ea5e9';
                    container.nextElementSibling.style.transform = 'translateX(100%)';
                } else {
                    container.style.backgroundColor = 'rgba(156, 163, 175, 0.5)';
                    container.nextElementSibling.style.transform = 'translateX(0)';
                }
            });
        }
    });
});
</script>
{% endblock %}
